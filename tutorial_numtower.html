
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
  
  <!-- Licensed under the Apache 2.0 License -->
  <link rel="stylesheet" type="text/css" href="_static/fonts/open-sans/stylesheet.css" />
  <!-- Licensed under the SIL Open Font License -->
  <link rel="stylesheet" type="text/css" href="_static/fonts/source-serif-pro/source-serif-pro.css" />
  <link rel="stylesheet" type="text/css" href="_static/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="_static/css/bootstrap-theme.min.css" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
    <title>The numerical tower and type coercion &#8212; mp++ 0.20 documentation</title>
    <link rel="stylesheet" href="_static/guzzle.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Common operators" href="tutorial_commonops.html" />
    <link rel="prev" title="Input and output" href="tutorial_io.html" />
  
   

  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="tutorial_commonops.html" title="Common operators"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="tutorial_io.html" title="Input and output"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">mp++ 0.20 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="tutorial.html" accesskey="U">Tutorial</a> &#187;</li> 
      </ul>
    </div>
    <div class="container-wrapper">

      <div id="mobile-toggle">
        <a href="#"><span class="glyphicon glyphicon-align-justify" aria-hidden="true"></span></a>
      </div>
  <div id="left-column">
    <div class="sphinxsidebar"><a href="
    index.html" class="text-logo">mp++</a>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <h2>Table Of Contents</h2>
  </div>
  <div class="sidebar-toc">
    
    
      <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="tutorial.html">Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="tutorial_prelim.html">Preliminaries</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_constr.html">Construction, conversion and assignment</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_io.html">Input and output</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">The numerical tower and type coercion</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_commonops.html">Common operators</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_api.html">API overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_integer.html">Integer tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_rational.html">Rational tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_real128.html">Quadruple-precision float tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_real.html">Multiprecision float tutorial</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_pybind11.html">Extra: integration with pybind11</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="benchmarks.html">Benchmarks</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>

    
  </div>
</div>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <div id="main-search">
      <form class="form-inline" action="search.html" method="GET" role="form">
        <div class="input-group">
          <input name="q" type="text" class="form-control" placeholder="Search...">
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div>
      
    </div>
  </div>
        <div id="right-column">
          
          <div role="navigation" aria-label="breadcrumbs navigation">
            <ol class="breadcrumb">
              <li><a href="index.html">Docs</a></li>
              
                <li><a href="tutorial.html">Tutorial</a></li>
              
              <li>The numerical tower and type coercion</li>
            </ol>
          </div>
          
          <div class="document clearer body">
            
  <div class="section" id="the-numerical-tower-and-type-coercion">
<span id="tutorial-numtower"></span><h1>The numerical tower and type coercion<a class="headerlink" href="#the-numerical-tower-and-type-coercion" title="Permalink to this headline">¶</a></h1>
<p>Before proceeding to show how mp++’s classes can be used to perform arithmetic computations,
it is useful to introduce first the hierarchy on top of which mp++’s type coercion
is built.</p>
<p>In a broad sense, mp++ aims to extend C++’s type hierarchy with multiprecision
numerical types. In C++, when numerical operands of different types are involved
in an arithmetic operation, all operands are converted (or <em>coerced</em>) into a
common type determined from the types of the operands. The converted operands
are then used in place of the original operands to perform the operation,
and the type of the result will be the common type. For instance:</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="k">auto</span> <span class="n">a</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">5l</span><span class="p">;</span>   <span class="c1">// &#39;4&#39; is int, &#39;5l&#39; is long: a will be long.</span>
<span class="k">auto</span> <span class="n">b</span> <span class="o">=</span> <span class="mf">4.f</span> <span class="o">+</span> <span class="mi">5l</span><span class="p">;</span> <span class="c1">// &#39;4.f&#39; is float, &#39;5l&#39; is long: b will be float.</span>
<span class="k">auto</span> <span class="n">c</span> <span class="o">=</span> <span class="mf">4.f</span> <span class="o">+</span> <span class="mf">5.</span><span class="p">;</span> <span class="c1">// &#39;4.f&#39; is float, &#39;5.&#39; is double: c will be double.</span>
</pre></div>
</div>
<p>In order to determine the common type, C++ assigns a rank to each fundamental type.
In an operation involving operands of different types, the type of the result will be
the type with the highest rank among the types of the operands. Although there are
a few complications and caveats, the general rule in C++ is that integral types have
a lower rank than floating-point types, and that, within the integral and floating-point
types, a higher range or bit width translates to a higher rank. The underlying
idea is that automatic type coercion should not change the value of an operand <a class="footnote-reference" href="#f1" id="id1">[1]</a>.</p>
<p>mp++ extends C++’s type hierarchy in a (hopefully) natural way:</p>
<ul class="simple">
<li><a class="reference internal" href="integer.html#_CPPv4I_NSt6size_tEEN4mppp7integerE" title="mppp::integer"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">integer</span></code></a> has a rank higher than any C++ integral type, but lower
than any C++ floating-point type;</li>
<li><a class="reference internal" href="rational.html#_CPPv4I_NSt6size_tEEN4mppp8rationalE" title="mppp::rational"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">rational</span></code></a> has a rank higher than <a class="reference internal" href="integer.html#_CPPv4I_NSt6size_tEEN4mppp7integerE" title="mppp::integer"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">integer</span></code></a>, but lower
than any C++ floating-point type;</li>
<li><a class="reference internal" href="real128.html#_CPPv4N4mppp7real128E" title="mppp::real128"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">real128</span></code></a> has a rank higher than any C++ floating-point type;</li>
<li><a class="reference internal" href="real.html#_CPPv4N4mppp4realE" title="mppp::real"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">real</span></code></a> has a rank higher than <a class="reference internal" href="real128.html#_CPPv4N4mppp7real128E" title="mppp::real128"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">real128</span></code></a>.</li>
</ul>
<p>In other words, mp++’s type hierarchy (or <em>numerical tower</em>) from the lowest rank to the highest is the following:</p>
<ul class="simple">
<li>C++ integral types,</li>
<li><a class="reference internal" href="integer.html#_CPPv4I_NSt6size_tEEN4mppp7integerE" title="mppp::integer"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">integer</span></code></a>,</li>
<li><a class="reference internal" href="rational.html#_CPPv4I_NSt6size_tEEN4mppp8rationalE" title="mppp::rational"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">rational</span></code></a>,</li>
<li>C++ floating-point types,</li>
<li><a class="reference internal" href="real128.html#_CPPv4N4mppp7real128E" title="mppp::real128"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">real128</span></code></a>,</li>
<li><a class="reference internal" href="real.html#_CPPv4N4mppp4realE" title="mppp::real"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">real</span></code></a>.</li>
</ul>
<p>Note that up to and including <a class="reference internal" href="rational.html#_CPPv4I_NSt6size_tEEN4mppp8rationalE" title="mppp::rational"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">rational</span></code></a>, types with higher rank can represent exactly all values
of any type with a lower rank. The floating-point types, however, cannot represent exactly all values representable
by <a class="reference internal" href="rational.html#_CPPv4I_NSt6size_tEEN4mppp8rationalE" title="mppp::rational"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">rational</span></code></a>, <a class="reference internal" href="integer.html#_CPPv4I_NSt6size_tEEN4mppp7integerE" title="mppp::integer"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">integer</span></code></a> or even the C++ integral types. It should also be noted
that <a class="reference internal" href="real.html#_CPPv4N4mppp4realE" title="mppp::real"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">real</span></code></a>’s precision is set at runtime, and it is thus possible to create <a class="reference internal" href="real.html#_CPPv4N4mppp4realE" title="mppp::real"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">real</span></code></a>
objects with a precision lower than <a class="reference internal" href="real128.html#_CPPv4N4mppp7real128E" title="mppp::real128"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">real128</span></code></a> or any of the C++ floating-point types. Regardless,
when it comes to type coercion, <a class="reference internal" href="real.html#_CPPv4N4mppp4realE" title="mppp::real"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">real</span></code></a> is always assigned a rank higher than any other type.</p>
<p>mp++’s type coercion rules extend beyond arithmetic operators. The exponentiation functions <code class="docutils literal notranslate"><span class="pre">pow()</span></code>, for instance,
also use the type hierarchy to determine the type of the result. Type coercion is also applied in the comparison operators,
where arguments of different types are promoted to the common type before actually carrying out the comparison.</p>
<p class="rubric">Footnotes</p>
<table class="docutils footnote" frame="void" id="f1" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>Strictly speaking, this is of course not true. On modern architectures, a large enough
64-bit <code class="docutils literal notranslate"><span class="pre">long</span> <span class="pre">long</span></code> will be subject to a lossy conversion to, e.g., <code class="docutils literal notranslate"><span class="pre">float</span></code>
during type coercion.</td></tr>
</tbody>
</table>
</div>


          </div>
            
  <div class="footer-relations">
    
      <div class="pull-left">
        <a class="btn btn-default" href="tutorial_io.html" title="previous chapter (use the left arrow)">Input and output</a>
      </div>
    
      <div class="pull-right">
        <a class="btn btn-default" href="tutorial_commonops.html" title="next chapter (use the right arrow)">Common operators</a>
      </div>
    </div>
    <div class="clearer"></div>
  
        </div>
        <div class="clearfix"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="tutorial_commonops.html" title="Common operators"
             >next</a> |</li>
        <li class="right" >
          <a href="tutorial_io.html" title="Input and output"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">mp++ 0.20 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="tutorial.html" >Tutorial</a> &#187;</li> 
      </ul>
    </div>
<script type="text/javascript">
  $("#mobile-toggle a").click(function () {
    $("#left-column").toggle();
  });
</script>
<script type="text/javascript" src="_static/js/bootstrap.js"></script>
  <div class="footer">
    &copy; Copyright 2016-2020, Francesco Biscani. Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>.
  </div>
  </body>
</html>